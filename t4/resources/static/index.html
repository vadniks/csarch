<!DOCTYPE html>
<!--suppress HtmlFormInputWithoutLabel -->
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>a</title>
        <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
        <script src="stomp.js"></script>
        <script>
            const en = '/in', de = '/webs/ot', ds = '/webs/in', fr = (Math.random() * 100).toString()
            let aa = false, bb, cc

            function a() {
                if (!cc) cc = document.querySelectorAll('button')
                if (!(aa = !aa)) { b(); return }
                const a = new SockJS(en)
                bb = Stomp.over(a)
                bb.connect({}, _ => {
                    d('disconnect')
                    bb.subscribe(de, $b => c(JSON.parse($b.body)))
                })
            }

            function b() {
                if (!bb) return
                bb.disconnect()
                d('connect')
            }

            function c(a) {
                const b = document.createElement('p')
                b.textContent += a.a + ' | ' + a.b + ` (${a.c})\n`
                document.querySelector('div').appendChild(b)
            }

            function d(a) { cc[0].textContent = a }

            function e() { bb.send(ds, {}, JSON
                .stringify({a: fr, b: document.querySelector('input').value})) }
        </script>
    </head>
    <body onload="b()">
        <button onclick="a()">Connect</button>
        <br/>
        <input type="text" placeholder="msg"/>
        <button onclick="e()">Send</button>
        <div></div>
    </body>
</html>